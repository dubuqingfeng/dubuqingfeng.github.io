<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Linux VPS的一些配置 - 独步清风's blog</title>

  <!-- CSS  -->
  <link href="/theme/css/ma.css" type="text/css" rel="stylesheet" media="screen,projection"/>
  <link rel="stylesheet" type="text/css" href="/theme/css/pygments.css" media="screen,projection">
  <link href="/theme/css/style.css" type="text/css" rel="stylesheet" media="screen,projection"/>
  <script src="/theme/js/jquery-1.11.2.min.js"></script>
  <script>
  var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "//hm.baidu.com/hm.js?76712397de583de526f98e457deb2a7d";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
  })();
  </script>
</head>
<body>
  <!-- Top-navigation -->
  <nav class="lighten-5" role="navigation">
    <div class="container nav-wrapper">
      <a id="logo-container" href="http://dubuqingfeng.github.io" class="brand-logo"><span class="blue-grey-text text-darken-4">独步清风</span></a>

      <ul class="right hide-on-med-and-down">
		<li>
			<div class="black-text">
				<form onsubmit="return dispatch()">
					<div class="input-field">
						<input type="search" id="search-field" class="field" required maxlength="" name="q">
						<label for="search-field" class="right"><i class="mdi-action-search black-text"></i></label>
					</div>
				</form>
			</div>
		</li>
        <li><a class="waves-effect waves-light" href="/feeds/all.rss.xml" target="_blank"><span class="blue-grey-text text-darken-4">RSS</span></a></li>
        <li><a class="waves-effect waves-light" href="https://github.com/dubuqingfeng" target="_blank"><span class="blue-grey-text text-darken-4">Github</span></a></li>
      </ul>
      <!--><ul class="right hide-on-large-only">
        <li><a class="waves-effect waves-light" href="#"><i class="mdi-action-search black-text"></i></a></li>
      </ul><-->
      <ul id="nav-mobile" class="side-nav">
        <li><a class="waves-effect waves-light" href="#">Navbar Link</a></li>
        <li><a class="waves-effect waves-light" href="/feeds/all.rss.xml"><span class="blue-grey-text text-darken-4">RSS</span></a></li>
        <li><a class="waves-effect waves-light" href="https://github.com/dubuqingfeng"><span class="blue-grey-text text-darken-4">Github</span></a></li>
      </ul>
      <a href="#" data-activates="nav-mobile" class="button-collapse"><i class="mdi-navigation-menu black-text"></i></a>
    </div>
  </nav>
  <div class="container">
    <div class="row template-content-page">
      <div class="col s12 m8 l9">
        <!-- Breadcrumb -->
        <div class="section">
          <ul class="collapsible" data-collapsible="accordion">
            <li>
<div class="collapsible-header"><a href="/category/linux.html"><i class="mdi-action-subject"></i>【Linux】</a><a href="#">--Linux VPS的一些配置</a>              </div>
              <div class="collapsible-body"><p>对于Linux的VPS的一些基础设置，例如更换端口，加强登录验证，日志的记录，shadowsocks的安装，shadowsocks的优化等。</p></div>
            </li>
          </ul>
        </div>
        <!-- Article Lists -->
<div class="section">
  <div class="card z-depth-1">
    <div class="card-content black-text">
      <span class="card-title black-text"><a href="/201505-vps-base-setting.html" class="black-text flow-text" id="title">Linux VPS的一些配置</a></span>
      <h5>0x01 更改默认ssh登录端口</h5>
<p>一般ssh是开放的，容易受到攻击或者爆破等行为。</p>
<div class="highlight"><pre>#vi /etc/ssh/sshd_config

#Port 22             //先把22注释掉

Port 2754            //添加一个新的端口
</pre></div>


<p>重启ssh服务</p>
<div class="highlight"><pre>service sshd restart
</pre></div>


<h5>0x02 使用密钥登录而不是密码</h5>
<p>在一个自用的vps上，避免使用密码登录，妥善保管好密钥，可以提高一定的安全性。</p>
<p>一开始使用Xshell的密钥生成工具，在工具选项卡中，有新建用户密钥生成向导，选择RSA，密钥长度为2048位，下一步输入私钥密码，涉及到了非对称加密，详细原理正在读《深入浅出密码学》，一些RSA算法，在256位密钥以上进行蛮力攻击时耗费时间较长。生成了pub格式的公钥。</p>
<p>将我们生成的pub公钥文件上传到/root/.ssh文件夹下面（如果没有我们需要创建），然后我们需要将id_rsa_2048.pub重命名为authorized_keys 并且用chmod 600 authorized_keys设置权限。</p>
<div class="highlight"><pre>chmod 600 /root/.ssh/authorized_keys
</pre></div>


<p>找到/etc/ssh/sshd_config ，把RSAAuthentication和PubkeyAuthentication两行前面的#注释去掉。</p>
<div class="highlight"><pre>vi /etc/ssh/sshd_config
</pre></div>


<p>重启sshd服务的另一种方法：</p>
<div class="highlight"><pre>Debian/Ubuntu执行：/etc/init.d/ssh restart
CentOS执行：/etc/init.d/sshd restart
</pre></div>


<p>禁止密码登录：</p>
<div class="highlight"><pre>vi /etc/ssh/sshd_config 文件
</pre></div>


<p>找到PasswordAuthentication后面的yes改成no。</p>
<h5>0x03 查看登录日志</h5>
<p>首先进入日志目录：</p>
<div class="highlight"><pre>cd /var/log
</pre></div>


<p>查看ssh用户的登录日志：</p>
<div class="highlight"><pre>less secure
</pre></div>


<p>查看登录成功的ip信息：</p>
<div class="highlight"><pre>last
</pre></div>


<p>查看登录失败的ip信息：</p>
<div class="highlight"><pre>lastb
</pre></div>


<h5>0x04 配置shadowsocks</h5>
<p>安装setuptools</p>
<div class="highlight"><pre>yum install -y python-setuptools
</pre></div>


<p>安装完毕后，easy_install命令就可以使用了。</p>
<p>安装pip，默认安装到/usr/bin目录下。</p>
<div class="highlight"><pre>easy_install pip
pip install shadowsocks
</pre></div>


<p>创建shadowsocks的配置文件：</p>
<div class="highlight"><pre>vi /etc/shadowsocks.json
</pre></div>


<p>内容如下：</p>
<div class="highlight"><pre>{
        &quot;server&quot;:&quot;your_server_ip&quot;,
        &quot;server_port&quot;:8989,
        &quot;local_address&quot;: &quot;127.0.0.1&quot;,
        &quot;local_port&quot;:1080,
        &quot;password&quot;:&quot;yourpassword&quot;,
        &quot;timeout&quot;:600,
        &quot;method&quot;:&quot;aes-256-cfb&quot;,
        &quot;fast_open&quot;: false,
        &quot;workers&quot;: 1
}
</pre></div>


<p>一些优化：</p>
<p>安装 gevent可以提高 Shadowsocks的性能。CentOS下安装gevent依赖libevent和greenlet。</p>
<p>安装libevent：</p>
<div class="highlight"><pre>yum install -y libevent
</pre></div>


<p>安装greenlet：</p>
<div class="highlight"><pre>pip install greenlet
</pre></div>


<p>安装gevent：</p>
<div class="highlight"><pre>pip install gevent
</pre></div>


<p>运行shadowsocks服务端：</p>
<div class="highlight"><pre>ssserver -c /etc/shadowsocks.json
</pre></div>


<p>如果想在后台一直运行Shadowsocks，启动命令如下：</p>
<div class="highlight"><pre>nohup ssserver -c /etc/shadowsocks.json &gt; /dev/null 2&gt;&amp;1 &amp;
</pre></div>


<p>防火墙的设置</p>
<p>编辑防火墙配置文件/etc/sysconfig/iptables，将服务器端口（server_port）放行。
新增一条防火墙规则：</p>
<div class="highlight"><pre>-A INPUT -m state --state NEW -m tcp -p tcp --dport 8989 -j ACCEPT
</pre></div>


<p>重启防火墙iptables：</p>
<div class="highlight"><pre>service iptables restart
</pre></div>


<p>使用docker部署shadowsocks服务。</p>
<p>1.安装并测试Docker，可以参考官方文档。或者是《Docker入门与实践》安装一节。</p>
<p>2.拉取镜像</p>
<div class="highlight"><pre>docker pull index.alauda.cn/dubuqingfeng/ubuntu-shadowsocks
</pre></div>


<p>3.运行容器</p>
<div class="highlight"><pre>docker run -d -p 1984:1984 index.alauda.cn/dubuqingfeng/ubuntu-shadowsocks -p 1984 -k sspassword -m aes-256-cfb
</pre></div>


<p>1984即为服务器端口。</p>
<p>sspassword为连接密码，自行更换。</p>
<p>aes-256-cfb为加密方式。</p>
<p>也可以使用-c /etc/shadowsocks.json参数。</p>
<p>4.测试运行</p>
<div class="highlight"><pre>docker ps -a
</pre></div>


<p>如果出现up即为安装成功。</p>
<p>Centos7版本：</p>
<div class="highlight"><pre>docker pull index.alauda.cn/dubuqingfeng/centos7-shadowsocks
</pre></div>


<p>运行容器</p>
<div class="highlight"><pre>docker run -d -p 1984:1984 index.alauda.cn/dubuqingfeng/centos7-shadowsocks -p 1984 -k sspassword -m aes-256-cfb
</pre></div>


<h5>0x05 Koding环境配置pelican简记</h5>
<p>Koding是一个在线IDE环境，适合进行Web方面的开发，支持Java、PHP、NodeJS、Perl、Python、Ruby、C、C++和Go等编程语言，貌似不太好绑定自定义域名。</p>
<div class="highlight"><pre>sudo apt-get install python-pip
pip install pelican
sudo apt-get install python-virtualenv
</pre></div>


<h5>0x06 后记</h5>
<p>需要进一步学习SSH协议，Linux服务器管理，密码学，sock5代理，iptables。</p>
<p>路漫漫，盖余之勤且艰若此。</p>
<p>专注地做好每一件事。</p>	
    </div>
    <div class="card-action">
      <a class="orange-text text-accent-2" href="/category/linux.html" onclick="">2015-05-16 12:53:00</a>
<a href="/tag/linux.html">Linux</a><a href="/tag/vps.html">vps</a>    </div>
  </div>
</div>
<div class="section">
  <div class="card z-depth-1">
    <div class="card-content">
			<div class="row">
				<div class="col s12">
					<h3>Comments</h3>
					<div id="disqus_thread"></div>
					<script type="text/javascript">
						var disqus_shortname = 'dubuqingfeng';
						(function() {
							var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
							dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
							(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
						})();
					</script>
					<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
					<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
				</div>
			</div>
		</div>
  </div>
</div>
      </div>
      <div class="col s12 m4 l3">
        <div class="section">
          <div class="card-panel z-depth-1">
            <div class="card black-text sidebar-title">
              <span class="black-text sidebar-title-text"><a href="/categories.html" class="black-text flow-text" id="title">分类</a></span>
            </div>
            <div class="row valign-wrapper">
              <div class="col s12">
                <div class="card-action">
                  <ul class="">
                    <li ><a href="/category/2014.html">【2014】</a></li>
                    <li ><a href="/category/android.html">【Android】</a></li>
                    <li ><a href="/category/dian-zi-she-ji.html">【电子设计】</a></li>
                    <li ><a href="/category/github.html">【github】</a></li>
                    <li ><a href="/category/kua-ping-tai-kai-fa.html">【跨平台开发】</a></li>
                    <li class="active"><a href="/category/linux.html">【Linux】</a></li>
                    <li ><a href="/category/php.html">【php】</a></li>
                    <li ><a href="/category/test.html">【test】</a></li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="section">
          <div class="card-panel z-depth-1">
            <div class="card black-text sidebar-title">
              <span class="black-text sidebar-title-text"><a href="/tags.html" class="black-text flow-text" id="title">标签</a></span>
            </div>
            <div class="row valign-wrapper">
              <div class="col s12">
                <div class="card-action">
                    <a class="" href="/tag/dian-zi-she-ji.html">电子设计</a>
                    <a class="" href="/tag/linux.html">Linux</a>
                    <a class="" href="/tag/github-pages.html">github pages</a>
                    <a class="" href="/tag/jie-mo-fang-ji-qi-ren.html">解魔方机器人</a>
                    <a class="" href="/tag/pelican.html">pelican</a>
                    <a class="" href="/tag/preferencefragment.html">PreferenceFragment</a>
                    <a class="" href="/tag/nian-zhong-zong-jie.html">年终总结</a>
                    <a class="" href="/tag/whois.html">whois</a>
                    <a class="" href="/tag/fork.html">fork</a>
                    <a class="" href="/tag/git.html">git</a>
                    <a class="" href="/tag/php.html">php</a>
                    <a class="" href="/tag/qml.html">qml</a>
                    <a class="" href="/tag/2014.html">2014</a>
                    <a class="" href="/tag/ubuntu-sdk.html">ubuntu sdk</a>
                    <a class="" href="/tag/seo.html">seo</a>
                    <a class="" href="/tag/ionic.html">ionic</a>
                    <a class="" href="/tag/vps.html">vps</a>
                    <a class="" href="/tag/rfid.html">RFID</a>
                    <a class="" href="/tag/android.html">Android</a>
                    <a class="" href="/tag/ubuntu-touch.html">ubuntu touch</a>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="section">
          <div class="card-panel z-depth-1">
            <div class="card black-text sidebar-title">
              <span class="black-text sidebar-title-text"><a href="/tags.html" class="black-text flow-text" id="title">归档</a></span>
            </div>
            <div class="row valign-wrapper">
              <div class="col s12">
                <div class="card-action">
				<ul class="">
						<li><a href="/">六月 2015 (1)</a></li>
						<li><a href="/">五月 2015 (2)</a></li>
						<li><a href="/">四月 2015 (3)</a></li>
						<li><a href="/">三月 2015 (5)</a></li>
						<li><a href="/">二月 2015 (3)</a></li>
                </div>
              </div>
            </div>
          </div>
        </div>
<div class="section">
  <div class="card-panel z-depth-1">
    <div class="card black-text sidebar-title">
      <span class="black-text sidebar-title-text"><a href="https://github.com/dubuqingfeng" class="black-text flow-text" id="title">GitHub</a></span>
    </div>
    <div class="row valign-wrapper">
      <div class="col s12">
        <div class="card-action">
          <ul class="" id="gh_repos">
			<li class="loading">Status updating...</li>
          </ul>
        </div>
      </div>
    </div>
  </div>
<script type="text/javascript">
$(document).ready(function () {
    if (!window.jXHR) {
        var jxhr = document.createElement('script');
        jxhr.type = 'text/javascript';
        jxhr.src = 'http://dbqf.xyz/theme/js/jXHR.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(jxhr, s);
    }

    github.showRepos({
        user: 'dubuqingfeng',
        count: 5,
        skip_forks: false,
        target: '#gh_repos'
    });
});
</script>
<script src="/theme/js/github.js" type="text/javascript"> </script>
</div>
        <div class="section">
          <div class="card-panel z-depth-1">
            <div class="card black-text sidebar-title">
              <span class="black-text sidebar-title-text"><a href="" class="black-text flow-text" id="title">链接</a></span>
            </div>
            <div class="row valign-wrapper">
              <div class="col s12">
                <div class="card-action">
                  <ul class="">
                    <li><a href="http://smartki.sinaapp.com">Changyanlong</a></li>
                    <li><a href="http://1433.sinaapp.com">1433</a></li>
                    <li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
                    <li><a href="#"></a></li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Footer -->
  <footer class="page-footer z-depth-2">
    <div class="container footer-content">
      <div class="row">
        <div class="col l12 s12">
          <a href="#top"><button class="btn waves-effect waves-light blue darken-3 right" alt="Back To Top">Top
          </button></a>
          <button class="btn waves-effect waves-light blue darken-3" type="submit" name="action" alt="PayPal - The safer, easier way to pay online!">Support
          </button>
          <button class="btn waves-effect waves-light blue darken-3" type="submit" name="action" alt="PayPal - The safer, easier way to pay online!">Projects
          </button>
          <button class="btn waves-effect waves-light blue darken-3" type="submit" name="action" alt="PayPal - The safer, easier way to pay online!">About
          </button>
        </div>
      </div>
    </div>
    <div class="footer-copyright z-depth-1">
      <div class="container">
        <div class="row">
          <div class="col l12 s12 grey-text text-darken-4 hide-on-small-only">
            Powered by <a class="amber-text text-darken-4" href="http://getpelican.com" target="_blank">Pelican</a>. <span class="right">Theme by <a class="amber-text text-darken-4" href="http://dbqf.xyz">Dubuqingfeng</a>.
          </div>
          <div class="col l12 s12 grey-text text-darken-4 hide-on-med-and-up">
            <span class="right">Theme by <a class="amber-text text-darken-4" href="http://dbqf.xyz">Dubuqingfeng</a>.
          </div>
        </div>
      </div>
    </div>
  </footer>
  <!--  Scripts-->
  
  <script src="/theme/js/ma.js"></script>
  <script src="/theme/js/init.js"></script>
  <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
  <script src="/theme/js/highlight.pack.js"></script>
  </body>
</html>