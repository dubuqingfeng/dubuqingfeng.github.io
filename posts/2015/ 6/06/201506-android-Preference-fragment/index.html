<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>如何使用PreferenceFragment方便地完成设置界面 - 独步清风's blog</title>

  <!-- CSS  -->
  <link href="/theme/css/ma.css" type="text/css" rel="stylesheet" media="screen,projection"/>
  <link rel="stylesheet" type="text/css" href="/theme/css/pygments.css" media="screen,projection">
  <link href="/theme/css/style.css" type="text/css" rel="stylesheet" media="screen,projection"/>
  <script src="/theme/js/jquery-1.11.2.min.js"></script>
  <script>
  var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "//hm.baidu.com/hm.js?76712397de583de526f98e457deb2a7d";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
  })();
  </script>
</head>
<body>
  <!-- Top-navigation -->
  <nav class="lighten-5" role="navigation">
    <div class="container nav-wrapper">
      <a id="logo-container" href="http://dbqf.xyz" class="brand-logo"><span class="blue-grey-text text-darken-4">独步清风</span></a>
      <ul class="right hide-on-med-and-down">
        <li>
          <div class="black-text">
            <form onsubmit="return dispatch()">
              <div class="input-field">
                <input type="search" id="search-field" class="field" required maxlength="" name="q">
                <label for="search-field" class="right"><i class="mdi-action-search black-text"></i></label>
              </div>
            </form>
          </div>
        </li>
        <li><a class="waves-effect waves-light" href="/feeds/all.rss.xml" target="_blank"><span class="blue-grey-text text-darken-4">RSS</span></a></li>
        <li><a class="waves-effect waves-light" href="https://github.com/dubuqingfeng" target="_blank"><span class="blue-grey-text text-darken-4">Github</span></a></li>
      </ul>
      <ul class="right hide-on-large-only">
        <li><a class="waves-effect waves-light" href="#"><i class="mdi-action-search black-text"></i></a></li>
      </ul>
      <ul id="nav-mobile" class="side-nav">
        <li><a class="waves-effect waves-light" href="#">Navbar Link</a></li>
        <li><a class="waves-effect waves-light" href="/feeds/all.rss.xml"><span class="blue-grey-text text-darken-4">RSS</span></a></li>
        <li><a class="waves-effect waves-light" href="https://github.com/dubuqingfeng"><span class="blue-grey-text text-darken-4">Github</span></a></li>
      </ul>
      <a href="#" data-activates="nav-mobile" class="button-collapse"><i class="mdi-navigation-menu black-text"></i></a>
    </div>
  </nav>
  <div class="container">
    <div class="row template-content-page">
      <div class="col s12 m8 l9">
        <!-- Breadcrumb -->
        <div class="section">
          <ul class="collapsible" data-collapsible="accordion">
            <li>
<div class="collapsible-header"><a href="/category/android.html"><i class="mdi-action-subject"></i>【Android】</a><a href="#">--如何使用PreferenceFragment方便地完成设置界面</a>              </div>
              <div class="collapsible-body"><p>在android中，利用PreferenceFragment快速完成设置界面以及一些思考。</p></div>
            </li>
          </ul>
        </div>
        <!-- Article Lists -->
<div class="section">
  <div class="card z-depth-1">
    <div class="card-content black-text">
      <span class="card-title black-text"><a href="/posts/2015/ 6/06/201506-android-Preference-fragment/index.html" class="black-text flow-text" id="title">如何使用PreferenceFragment方便地完成设置界面</a></span>
      <h5>0x01 前言</h5>
<p>在设置界面的开发时，以前往往通过自己写界面，在没有合适美工时，比较费时费力，尤其是以前需要兼容Android2.3的时候。当3.0以后出现了PreferenceFragment，可以快速地完成一个类似于系统设置的偏好设定界面。</p>
<p>在android3.0以后，官方推荐使用PreferenceFragment去替代PreferenceActivity。
以及一些配置。</p>
<h5>0x02 浅析</h5>
<p>PreferenceFragment是继承于Fragment，实现了PreferenceManager.OnPreferenceTreeClickListener这些接口。</p>
<div class="highlight"><pre><span class="cm">/**</span>
<span class="cm"> * Interface definition for a callback to be invoked when a</span>
<span class="cm"> * {@link Preference} in the hierarchy rooted at this </span>
<span class="cm"> * {@link PreferenceScreen} is</span>
<span class="cm"> * clicked.</span>
<span class="cm"> *</span>
<span class="cm"> * @hide</span>
<span class="cm"> */</span><span class="w"></span>
public<span class="w"> </span>interface<span class="w"> </span>OnPreferenceTreeClickListener<span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Called when a preference in the tree rooted at this</span>
<span class="cm">     * {@link PreferenceScreen} has been clicked.</span>
<span class="cm">     * </span>
<span class="cm">     * @param preferenceScreen The {@link PreferenceScreen} that the</span>
<span class="cm">     *        preference is located in.</span>
<span class="cm">     * @param preference The preference that was clicked.</span>
<span class="cm">     * @return Whether the click was handled.</span>
<span class="cm">     */</span><span class="w"></span>
<span class="w">    </span>boolean<span class="w"> </span>onPreferenceTreeClick<span class="o">(</span>PreferenceScreen<span class="w"> </span>
<span class="w">    </span>preferenceScreen<span class="o">,</span><span class="w"> </span>Preference<span class="w"> </span>preference<span class="o">)</span><span class="err">;</span><span class="w"></span>
<span class="err">}</span><span class="w"></span>
</pre></div>


<h5>0x03 完成步骤</h5>
<p>通过新建项目的方式：</p>
<p>在android-studio里，新建一个项目：PreferenceFragmentDemo</p>
<p>选择Blank Activity With Fragment，填写activity为SettingActivity。</p>
<p><strong>修改fragment继承PreferenceFragment。</strong></p>
<p>新建一个xml文件，建立/res/xml/preferences.xml</p>
<div class="highlight"><pre><span class="nt">&lt;PreferenceScreen</span>
    <span class="na">xmlns:android=</span><span class="s">&quot;http://schemas.android.com/apk/res/android&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;PreferenceCategory</span>
        <span class="na">android:title=</span><span class="s">&quot;设置A&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;CheckBoxPreference</span>
            <span class="na">android:key=</span><span class="s">&quot;checkbox_preference&quot;</span>
            <span class="na">android:title=</span><span class="s">&quot;标题&quot;</span>
            <span class="na">android:summary=</span><span class="s">&quot;详细&quot;</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;/PreferenceCategory&gt;</span>

    <span class="nt">&lt;PreferenceCategory</span>
        <span class="na">android:title=</span><span class="s">&quot;设置B&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;EditTextPreference</span>
            <span class="na">android:key=</span><span class="s">&quot;edittext_preference&quot;</span>
            <span class="na">android:title=</span><span class="s">&quot;标题&quot;</span>
            <span class="na">android:summary=</span><span class="s">&quot;详细&quot;</span>
            <span class="na">android:dialogTitle=</span><span class="s">&quot;对话框标题&quot;</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;/PreferenceCategory&gt;</span>

<span class="nt">&lt;/PreferenceScreen&gt;</span>
</pre></div>


<p>在SettingFragment中，通过addPreferencesFromResource(R.xml.preferences);加载上述的xml文件。</p>
<div class="highlight"><pre>@Override
public void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    addPreferencesFromResource(R.xml.preferences);
}
</pre></div>


<p>设置项保存到哪了？SharedPreferences。在/data/data/应用包名/shared_prefs/应用包名_preferences.xml文件中，android:key即为键值名。</p>
<p>如何读取设置？通过SharedPreferences</p>
<div class="highlight"><pre>SharedPreferences mySharedPreferences = PreferenceManager
        .getDefaultSharedPreferences(this);

boolean my_checkbox_preference = mySharedPreferences.getBoolean(
        &quot;checkbox_preference&quot;, false);
prefCheckBox.setChecked(my_checkbox_preference);

String my_edittext_preference = mySharedPreferences.getString(
        &quot;edittext_preference&quot;, &quot;&quot;);
prefEditText.setText(my_edittext_preference);
</pre></div>


<p>列表设置项的ListPreferences类：</p>
<div class="highlight"><pre>&lt;ListPreference
      android:key=&quot;list_preference&quot;
      android:title=&quot;@string/标题&quot;
      android:dialogTitle=&quot;@string/对话框标题&quot;
      android:entries=&quot;@array/listArray&quot;
      android:entryValues=&quot;@array/listValues&quot; /&gt;
</pre></div>


<p>entries和entryValues从哪来？/res/values/array.xml或者/res/values/strings.xml</p>
<div class="highlight"><pre><span class="nt">&lt;resources&gt;</span>
<span class="nt">&lt;string-array</span> <span class="na">name=</span><span class="s">&quot;listArray&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;item&gt;</span>Headings<span class="nt">&lt;/item&gt;</span>
    <span class="nt">&lt;item&gt;</span>Headings and Details<span class="nt">&lt;/item&gt;</span>
    <span class="nt">&lt;item&gt;</span>All Data<span class="nt">&lt;/item&gt;</span>
<span class="nt">&lt;/string-array&gt;</span>

<span class="nt">&lt;string-array</span> <span class="na">name=</span><span class="s">&quot;listValues&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;item&gt;</span>1<span class="nt">&lt;/item&gt;</span>
    <span class="nt">&lt;item&gt;</span>2<span class="nt">&lt;/item&gt;</span>
    <span class="nt">&lt;item&gt;</span>3<span class="nt">&lt;/item&gt;</span>
<span class="nt">&lt;/string-array&gt;</span>
<span class="nt">&lt;/resources&gt;</span>
</pre></div>


<p>preference-headers类</p>
<h5>0x04 Preference类</h5>
<p>前几天在SIMS(学生信息管理系统)项目中，涉及到了Preference这个类，当时可以通过输入输出流进行与文件的交互。</p>
<p>在Java里可以利用这个类进行一些配置信息的保存等。</p>
<p>详情可参考<a href="https://github.com/DigDream/SIMS/blob/master/src/com/student/sb/utils/PropertiesUtils.java">PropertiesUtils</a>的实现。</p>
<h5>0x05 思考</h5>
<p>其PreferenceFragment文件源码地址在：<a href="https://android.googlesource.com/platform/frameworks/base/+/master/core/java/android/preference/PreferenceFragment.java">GoogleSource</a>，其中利用了ListView进行界面绘制。另外grepcode.com这个网站是个不错的查看android源代码(AOSP)的网站。以及还有一些<a href="http://www.programcreek.com/java-api-examples/index.php?api=android.preference.PreferenceFragment">示例代码</a>。</p>
<p>并且文档里还介绍了android3.0以前如果想用PreferenceFragment怎么办，详细参考<a href="http://developer.android.com/guide/topics/ui/settings.html#BackCompatHeaders">这个链接</a>。</p>
<p><a href="源码分析"></a></p>
<h5>0x06 参考链接</h5>
<p><a href="http://developer.android.com/guide/topics/ui/settings.html">settings</a></p>
<p><a href="http://developer.android.com/reference/android/preference/PreferenceFragment.html">官方文档</a></p>
<p><a href="http://www.cs.dartmouth.edu/~campbell/cs65/lecture12/lecture12.html">Using PreferenceFragment to store user preferences</a></p>
<p><a href="https://github.com/codepath/android_guides/wiki/Settings-with-PreferenceFragment">Settings-with-PreferenceFragment</a></p>	
    </div>
    <div class="card-action">
      <a class="orange-text text-accent-2" href="/category/android.html" onclick="">2015-06-06 12:13:00</a>
<a href="/tag/android.html">Android</a><a href="/tag/preferencefragment.html">PreferenceFragment</a>    </div>
  </div>
</div>
<div class="section">
  <div class="card z-depth-1">
    <div class="card-content">
			<div class="row">
				<div class="col s12">
					<h3>Comments</h3>
					<div id="disqus_thread"></div>
					<script type="text/javascript">
						var disqus_shortname = 'dubuqingfeng';
						(function() {
							var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
							dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
							(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
						})();
					</script>
					<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
					<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
				</div>
			</div>
		</div>
  </div>
</div>
      </div>
      <div class="col s12 m4 l3">
        <div class="section">
          <div class="card-panel z-depth-1">
            <div class="card black-text sidebar-title">
              <span class="black-text sidebar-title-text"><a href="/categories.html" class="black-text flow-text" id="title">分类</a></span>
            </div>
            <div class="row valign-wrapper">
              <div class="col s12">
                <div class="card-action">
                  <ul class="">
                    <li ><a href="/category/2014.html">【2014】</a></li>
                    <li class="active"><a href="/category/android.html">【Android】</a></li>
                    <li ><a href="/category/dian-zi-she-ji.html">【电子设计】</a></li>
                    <li ><a href="/category/docker.html">【Docker】</a></li>
                    <li ><a href="/category/github.html">【github】</a></li>
                    <li ><a href="/category/kua-ping-tai-kai-fa.html">【跨平台开发】</a></li>
                    <li ><a href="/category/linux.html">【Linux】</a></li>
                    <li ><a href="/category/php.html">【php】</a></li>
                    <li ><a href="/category/test.html">【test】</a></li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="section">
          <div class="card-panel z-depth-1">
            <div class="card black-text sidebar-title">
              <span class="black-text sidebar-title-text"><a href="/tags.html" class="black-text flow-text" id="title">标签</a></span>
            </div>
            <div class="row valign-wrapper">
              <div class="col s12">
                <div class="card-action">
                    <a class="" href="/tag/pelican.html">pelican</a>
                    <a class="" href="/tag/qml.html">qml</a>
                    <a class="" href="/tag/nian-zhong-zong-jie.html">年终总结</a>
                    <a class="" href="/tag/linux.html">linux</a>
                    <a class="" href="/tag/seo.html">seo</a>
                    <a class="" href="/tag/ubuntu-touch.html">ubuntu touch</a>
                    <a class="" href="/tag/whois.html">whois</a>
                    <a class="" href="/tag/github-pages.html">github pages</a>
                    <a class="" href="/tag/preferencefragment.html">PreferenceFragment</a>
                    <a class="" href="/tag/2014.html">2014</a>
                    <a class="" href="/tag/android.html">Android</a>
                    <a class="" href="/tag/fork.html">fork</a>
                    <a class="" href="/tag/vps.html">vps</a>
                    <a class="" href="/tag/dian-zi-she-ji.html">电子设计</a>
                    <a class="" href="/tag/rfid.html">RFID</a>
                    <a class="" href="/tag/git.html">git</a>
                    <a class="" href="/tag/ubuntu.html">ubuntu</a>
                    <a class="" href="/tag/php.html">php</a>
                    <a class="" href="/tag/sdk.html">sdk</a>
                    <a class="" href="/tag/jie-mo-fang-ji-qi-ren.html">解魔方机器人</a>
                    <a class="" href="/tag/docker.html">Docker</a>
                    <a class="" href="/tag/ionic.html">ionic</a>
                    <a class="" href="/tag/cnutcon.html">CnutCon</a>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="section">
          <div class="card-panel z-depth-1">
            <div class="card black-text sidebar-title">
              <span class="black-text sidebar-title-text"><a href="/archives.html" class="black-text flow-text" id="title">归档</a></span>
            </div>
            <div class="row valign-wrapper">
              <div class="col s12">
                <div class="card-action">
                  <ul class="">
                      <li><a href="/posts/2015/ 8/index.html">八月 2015 (1)</a></li>
                      <li><a href="/posts/2015/ 6/index.html">六月 2015 (1)</a></li>
                      <li><a href="/posts/2015/ 5/index.html">五月 2015 (2)</a></li>
                      <li><a href="/posts/2015/ 4/index.html">四月 2015 (3)</a></li>
                      <li><a href="/posts/2015/ 3/index.html">三月 2015 (5)</a></li>
                      <li><a href="/posts/2015/ 2/index.html">二月 2015 (3)</a></li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- <div class="section">
          <div class="card-panel z-depth-1">
            <div class="card black-text sidebar-title">
              <span class="black-text sidebar-title-text"><a href="/tags.html" class="black-text flow-text" id="title">个人标签／个人项目链接</a></span>
            </div>
            <div class="row valign-wrapper">
              <div class="col s12">
                <div class="card-action">
                    <a class="" href="/tag/pelican.html">pelican</a>
                    <a class="" href="/tag/qml.html">qml</a>
                    <a class="" href="/tag/nian-zhong-zong-jie.html">年终总结</a>
                    <a class="" href="/tag/linux.html">linux</a>
                    <a class="" href="/tag/seo.html">seo</a>
                    <a class="" href="/tag/ubuntu-touch.html">ubuntu touch</a>
                    <a class="" href="/tag/whois.html">whois</a>
                    <a class="" href="/tag/github-pages.html">github pages</a>
                    <a class="" href="/tag/preferencefragment.html">PreferenceFragment</a>
                    <a class="" href="/tag/2014.html">2014</a>
                    <a class="" href="/tag/android.html">Android</a>
                    <a class="" href="/tag/fork.html">fork</a>
                    <a class="" href="/tag/vps.html">vps</a>
                    <a class="" href="/tag/dian-zi-she-ji.html">电子设计</a>
                    <a class="" href="/tag/rfid.html">RFID</a>
                    <a class="" href="/tag/git.html">git</a>
                    <a class="" href="/tag/ubuntu.html">ubuntu</a>
                    <a class="" href="/tag/php.html">php</a>
                    <a class="" href="/tag/sdk.html">sdk</a>
                    <a class="" href="/tag/jie-mo-fang-ji-qi-ren.html">解魔方机器人</a>
                    <a class="" href="/tag/docker.html">Docker</a>
                    <a class="" href="/tag/ionic.html">ionic</a>
                    <a class="" href="/tag/cnutcon.html">CnutCon</a>
                </div>
              </div>
            </div>
          </div>
        </div> -->
<div class="section">
  <div class="card-panel z-depth-1">
    <div class="card black-text sidebar-title">
      <span class="black-text sidebar-title-text"><a href="https://github.com/dubuqingfeng" class="black-text flow-text" id="title">GitHub</a></span>
    </div>
    <div class="row valign-wrapper">
      <div class="col s12">
        <div class="card-action">
          <ul class="" id="gh_repos">
			<li class="loading">状态更新中...</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

<script type="text/javascript">
$(document).ready(function () {
    if (!window.jXHR) {
        var jxhr = document.createElement('script');
        jxhr.type = 'text/javascript';
        jxhr.src = '/theme/js/jXHR.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(jxhr, s);
    }

    github.showRepos({
        user: 'dubuqingfeng',
        count: 5,
        skip_forks: false,
        target: '#gh_repos'
    });
});
</script>
<script src="/theme/js/github.js" type="text/javascript"> </script>
</div>
        <div class="section">
          <div class="card-panel z-depth-1">
            <div class="card black-text sidebar-title">
              <span class="black-text sidebar-title-text"><a href="" class="black-text flow-text" id="title">链接</a></span>
            </div>
            <div class="row valign-wrapper">
              <div class="col s12">
                <div class="card-action">
                  <ul class="">
                    <li><a href="http://getpelican.com/">Pelican</a></li>
                    <li><a href="http://python.org/">1433</a></li>
                    <li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
                    <li><a href="#"></a></li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Footer -->
  <footer class="page-footer z-depth-2">
    <div class="container footer-content">
      <div class="row">
        <div class="col l12 s12">
          <a href="#top"><button class="btn waves-effect waves-light blue darken-3 right" alt="Back To Top">Top
          </button></a>
          <button class="btn waves-effect waves-light blue darken-3" type="submit" name="action" alt="PayPal - The safer, easier way to pay online!">Support
          </button>
          <button class="btn waves-effect waves-light blue darken-3" type="submit" name="action" alt="PayPal - The safer, easier way to pay online!">Projects
          </button>
          <button class="btn waves-effect waves-light blue darken-3" type="submit" name="action" alt="PayPal - The safer, easier way to pay online!">About
          </button>
        </div>
      </div>
    </div>
    <div class="footer-copyright z-depth-1">
      <div class="container">
        <div class="row">
          <div class="col l12 s12 grey-text text-darken-4 hide-on-small-only">
            Powered by <a class="amber-text text-darken-4" href="http://getpelican.com" target="_blank">Pelican</a>. <span class="right">Theme by <a class="amber-text text-darken-4" href="http://dbqf.xyz">Dubuqingfeng</a>.
          </div>
          <div class="col l12 s12 grey-text text-darken-4 hide-on-med-and-up">
            <span class="right">Theme by <a class="amber-text text-darken-4" href="http://dbqf.xyz">Dubuqingfeng</a>.
          </div>
        </div>
      </div>
    </div>
  </footer>
  <!--  Scripts-->
  
  <script src="/theme/js/ma.js"></script>
  <script src="/theme/js/init.js"></script>
  <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
  <script src="/theme/js/highlight.pack.js"></script>
  </body>
</html>